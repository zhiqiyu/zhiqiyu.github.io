<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Memory Ownership in C Explained</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta name="generator" content="Hugo 0.50" />
	<meta property="og:title" content="Memory Ownership in C Explained" />
<meta property="og:description" content="The memory ownership problem or pointer ownership problem is a problem generally seen in C and C&#43;&#43; programs. The problem is generally violating a simple assumption that there should be only one pointer to a given piece of memory, so that when the memory is freed, no other pointers will point to an address that has already been freed.
For example, you have a main function, in which a pointer gfcontext_t *ctx to a struct gfcontext_t is created." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhiqiyu.github.io/post/memory-ownership-in-c-explained/" /><meta property="article:published_time" content="2019-09-25T17:07:25-04:00"/>
<meta property="article:modified_time" content="2019-09-25T17:07:25-04:00"/>

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Memory Ownership in C Explained"/>
<meta name="twitter:description" content="The memory ownership problem or pointer ownership problem is a problem generally seen in C and C&#43;&#43; programs. The problem is generally violating a simple assumption that there should be only one pointer to a given piece of memory, so that when the memory is freed, no other pointers will point to an address that has already been freed.
For example, you have a main function, in which a pointer gfcontext_t *ctx to a struct gfcontext_t is created."/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="https://zhiqiyu.github.io/css/style.css">
	<link rel="shortcut icon" href="https://zhiqiyu.github.io/img/favicon-96.png">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-128672710-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<link rel="stylesheet" href="https://zhiqiyu.github.io/css/xcode.css" rel="stylesheet" id="theme-stylesheet">
	<script src="https://zhiqiyu.github.io/js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

	<div class="container">
		<div class="logo" role="banner">
			<a class="logo__link" href="https://zhiqiyu.github.io/" title="ZQ.Yu" rel="home">
				<div class="logo__title">ZQ.Yu</div>
				<div class="logo__tagline">Geospatial data explorer, Machine learning enthusiast</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="https://zhiqiyu.github.io/">Blog</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="https://zhiqiyu.github.io/about/">About</a>
		</li>
	</ul>
</nav>

	</div>

	<script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://zhiqiyu.github.io/"
    },
    "articleSection" : "post",
    "name" : "Memory Ownership in C Explained",
    "headline" : "Memory Ownership in C Explained",
    "description" : "The memory ownership problem or pointer ownership problem is a problem generally seen in C and C++ programs. The problem is generally violating a simple assumption that there should be only one pointer to a given piece of memory, so that when the memory is freed, no other pointers will point to an address that has already been freed.
For example, you have a main function, in which a pointer gfcontext_t *ctx to a struct gfcontext_t is created.",
    "inLanguage" : "en-US",
    "author" : "img/avatar.jpgPh.D. student in Geoinformation ScienceZhiqi Yu",
    "creator" : "img/avatar.jpgPh.D. student in Geoinformation ScienceZhiqi Yu",
    "publisher": "img/avatar.jpgPh.D. student in Geoinformation ScienceZhiqi Yu",
    "accountablePerson" : "img/avatar.jpgPh.D. student in Geoinformation ScienceZhiqi Yu",
    "copyrightHolder" : "img/avatar.jpgPh.D. student in Geoinformation ScienceZhiqi Yu",
    "copyrightYear" : "2019",
    "datePublished": "2019-09-25 17:07:25 -0400 EDT",
    "dateModified" : "2019-09-25 17:07:25 -0400 EDT",
    "url" : "https://zhiqiyu.github.io/post/memory-ownership-in-c-explained/",
    "wordCount" : "441",
    "keywords" : [ "C","Blog" ]
}
</script>
</header>
		<div class="wrapper flex">
			<section class="primary">
			
<main class="main" role="main">
	<article class="post">
		
		<header class="post__header">
			<h1 class="post__title">Memory Ownership in C Explained</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
	<time class="meta__text" datetime="2019-09-25T17:07:25">September 25, 2019</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="https://zhiqiyu.github.io/categories/technical" rel="category">Technical</a></span>
</div>
</div>
		
		</header><div class="content post__content clearfix">
			<p>The memory ownership problem or pointer ownership problem is a problem generally seen in C and C++ programs. The problem is generally violating a simple assumption that there should be only one pointer to a given piece of memory, so that when the memory is freed, no other pointers will point to an address that has already been freed.</p>

<p>For example, you have a main function, in which a pointer <code>gfcontext_t *ctx</code> to a <code>struct gfcontext_t</code> is created. Let&rsquo;s say the <code>ctx</code> is located at address <code>y</code>, and its value is <code>x</code>, which is the address of the actual created data structure. If the address now need to be passed to a second function for additional process, if we directly pass <code>ctx</code> to the function, in the scope of this function, a local pointer variable at address <code>z</code> will be created, and it holds exactly same value as the passed-in <code>ctx</code>, i.e <code>y</code>, because function arguments are passed-by-value in C. What this implies is that there will be two pointers to the <code>y</code>, one in the main function, one in the second function. If the second function decide to free the memory of the data because it finished processing, the other pointer in the main function will not be affected, and it still holds the address to the data, which is just freed by the second function. The second function have no way to modify the <code>ctx</code> pointer in the main function because the function does not have the address of <code>ctx</code>.</p>

<p>A simple way to avoid such problem is to use a <strong>pointer-to-pointer</strong> as the function argument. The figure below illustrate the pointer relationship.</p>

<p><img src="https://zhiqiyu.github.io/img/memory_ownership.png" alt="memory ownership" /></p>

<p>Specifically, by passing <code>&amp;ctx</code> to the second function, the function will create a local variable at address <code>z</code> which holds the address of the pointer <code>*ctx</code>, i.e <code>y</code> in the main function. Now, if the second function need to free the data, all it needs to do is dereferencing the passed-in pointer-to-pointer, which gives us the value in the address of <code>ctx</code>, i.e <code>x</code>. Then we just call <code>free()</code> on the dereferenced pointer-to-pointer because is is the same as <code>free(x)</code>. After the data is properly freed, the pointer <code>ctx</code> in the main function is still lingering there, but now we have a &lsquo;handle&rsquo; of <code>ctx</code> in the scope of the second function, i.e the passed-in address of that variable. Therefore, we can set the value in that address to <code>NULL</code> and everything is properly cleaned.</p>

<p>The high-level code of the above process is as below:</p>

<pre><code class="language-C">void main() {
    gfcontext_t *ctx = malloc(sizeof(gfcontext_t));
    func(&amp;ctx);
}

void func(gfcontext **c) {
    // do something...
    free((*c));
    (*c) = NULL;
}
</code></pre>

		</div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373 0-.74-.24-1-.5L1 8a2.853 2.853 0 0 1-.7-1C.113 6.55 0 5.973 0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034 0 1.4 0h4.2c.373 0 .95.113 1.4.3.45.187.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="https://zhiqiyu.github.io/tags/c/" rel="tag">C</a></li>
	</ul>
</div>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Zhiqi Yu avatar" src="https://zhiqiyu.github.io/img/avatar.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Zhiqi Yu</span>
	</div>
	<div class="authorbox__description">
		Ph.D. student in Geoinformation Science
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="https://zhiqiyu.github.io/post/leetcode-94.-binary-tree-inorder-traversal/" rel="prev"><span class="post-nav__caption">Â«&thinsp;Previous</span><p class="post-nav__post-title">Leetcode 94. Binary Tree Inorder Traversal</p></a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "realm-z" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</section>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 Zhiqi Yu.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="https://zhiqiyu.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>